{"actions":[{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionSyncWithDropbox","parameters":{}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"","class":"WorkflowActionOpenDocument","parameters":{"filename":"exercises.csv","inDropbox":true}},{"pauseBeforeRunning":false,"pauseWithoutShowingParameters":false,"customTitle":"Capture Exercise Data","class":"WorkflowActionRunScript","parameters":{"script":"# -*- coding: utf-8 -*-\nimport re\nimport csv\nimport string\nimport pprint\nfrom datetime import date\n\nfrom console import hud_alert\nimport ui\nimport clipboard\nimport editor\n\nshows_result = False\n\nre.UNICODE = True\n\nclass NumericTextFieldDelegate (object):\n\tdef textfield_should_begin_editing(self, textfield):\n\t\treturn True\n\tdef textfield_did_begin_editing(self, textfield):\n\t\tpass\n\tdef textfield_did_end_editing(self, textfield):\n\t\tpass\n\tdef textfield_should_return(self, textfield):\n\t\ttextfield.end_editing()\n\t\treturn True\n\tdef textfield_should_change(self, textfield, range, replacement):\n\t\treturn True\n\tdef textfield_did_change(self, textfield):\n\t\tfixed_text = re.sub(r\"(\\D)\", \"\", textfield.text)\n\t\ttextfield.text = fixed_text\n\t\t\nview = ui.load_view()\n\nfields = {}\nfor name in ['push ups', 'sit ups']:\n\tfields[name] = view[name]\n\tfields[name].delegate = NumericTextFieldDelegate()\n\t\n#pushups_field = view['push ups']\n#pushups_field.keyboard_type = ui.KEYBOARD_DECIMAL_PAD\n#pushups_field.delegate = NumericTextFieldDelegate()\n\n#situps_field = view['sit ups']\n#situps_field.keyboard_type = ui.KEYBOARD_DECIMAL_PAD\n#situps_field.delegate = NumericTextFieldDelegate()\n\ndef get_newdata(exercises):\n\t# get new data into format\n\tvals = exercises.values()\n\ttoday = u'{:%Y-%m-%d}'.format(date.today())\n\tnewdata = [today]\n\tnewdata.extend(vals)\n\treturn ', '.join(newdata)\n\t\ndef get_olddata():\n\t# open existing file,read in old data\n\t#editor.close()\n\toldcsv = editor.get_file_contents('\/exercises.csv', 'dropbox')\n\toldlines = oldcsv.splitlines()\n\t#titles = oldlines.pop(0)\n\toldlines.pop(0)\n\treturn '\\n'.join(oldlines)\n\t\ndef get_titles(exercises):\n\t# update title line\n\tkeys = exercises.keys()\n\ttitles = ['date']\n\ttitles.extend(keys)\n\treturn ', '.join(map(lambda t: string.capwords(t), titles))\n\t\ndef update_csv(exercises):\n\tnewcsv = '\\n'.join([\n\t\tget_titles(exercises),\n\t\tget_newdata(exercises),\n\t\tget_olddata()\n\t])\n\teditor.set_file_contents('\/exercises.csv',newcsv,'dropbox')\n\t\n@ui.in_background\ndef done_input(sender):\n\t# iterate over text fields instead of extracting one by one\n\t# pull name and text value as key\/val for dict\n\t\n\texercises = {key: field.text for key, field in fields.iteritems()}\n\t\n\t#excercises = {}\n\t#for key, field in fields.iteritems:\n\t#\texcercises[key] = field.text\n\t\n\t#exercises = {\n\t#\t'push ups': pushups_field.text,\n\t#\t'sit ups': situps_field.text\n\t#}\n\tupdate_csv(exercises)\n\tview.close()\n\t\n\ndone_button = view['complete']\t\ndone_button.action = done_input\n\t\t\nview.present('popover', hide_title_bar=True)\n","ui":"[{\"frame\":\"{{0, 0}, {320, 320}}\",\"class\":\"View\",\"nodes\":[{\"frame\":\"{{100, 24}, {120, 40}}\",\"class\":\"TextField\",\"nodes\":[],\"attributes\":{\"uuid\":\"5725E0E4-0C28-4AD1-B047-42F1DC392F15\",\"flex\":\"WTB\",\"border_style\":3,\"border_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"alignment\":\"center\",\"autocorrection_type\":\"no\",\"enabled\":true,\"placeholder\":\"Push Ups\",\"text_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"spellchecking_type\":\"no\",\"name\":\"push ups\",\"font_size\":22}},{\"frame\":\"{{120, 258}, {80, 40}}\",\"class\":\"Button\",\"nodes\":[],\"attributes\":{\"alpha\":1,\"flex\":\"WT\",\"enabled\":true,\"title\":\"Done\",\"uuid\":\"506A78DD-6403-4A02-BBED-31E6C3992F43\",\"font_bold\":false,\"border_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"background_color\":\"RGBA(1.000000,1.000000,1.000000,1.000000)\",\"font_size\":20,\"name\":\"complete\"}},{\"frame\":\"{{100, 72}, {120, 40}}\",\"class\":\"TextField\",\"nodes\":[],\"attributes\":{\"uuid\":\"EE1DC29D-155F-4FE1-B234-5DE48AF801D8\",\"flex\":\"WTB\",\"border_style\":3,\"border_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"alignment\":\"center\",\"autocorrection_type\":\"no\",\"enabled\":true,\"placeholder\":\"Sit Ups\",\"text_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"spellchecking_type\":\"no\",\"name\":\"sit ups\",\"font_size\":22}}],\"attributes\":{\"name\":\"Exercise Log\",\"enabled\":true,\"tint_color\":\"RGBA(0.000000,0.478000,1.000000,1.000000)\",\"border_color\":\"RGBA(0.000000,0.000000,0.000000,1.000000)\",\"background_color\":\"RGBA(1.000000,1.000000,1.000000,1.000000)\",\"flex\":\"\"}}]"}}]}